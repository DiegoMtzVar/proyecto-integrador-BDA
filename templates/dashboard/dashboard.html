{% extends "wrapper.html" %}
{% from "macros.html" import menu, sidebar %}

{% block title %} SkateMotion Monterrey {% endblock %}

{% block menu %}
	{{ menu("Dashboard") }}
{% endblock %}

{% block script %}
<script>
$(document).ready(function(){
    $.getJSON('/dashboard/masCompradoHisto', function(data){
        // Process the data to extract names and quantities
        var names = data.map(function(item) { return item.nombre; });
        var quantities = data.map(function(item) { return parseInt(item.cantidad) ;  });
        // Initialize Highcharts
        Highcharts.chart('histograma', {
            chart: {
                type: 'column'
            },
            title: {
                text: 'Productos m&aacute;s comprados'
            },
            xAxis: {
                categories: names,
                title: {
                    text: 'Nombre de productos'
                }
            },
            yAxis: {
                title: {
                    text: 'Cantidades'
                }
            },
            series: [{
                name: 'Cantidad',
                data: quantities
            }]
        });
    });
	$.getJSON('/dashboard/porcentajeProveedor', function(data){
        var chartData = data.map(function(item) {
            return {
                name: item.nombreProveedor,
                y: parseFloat(item.porcentaje) * 100 
            };
        });
        
        Highcharts.chart('piechart', {
            chart: {
                type: 'pie'
            },
            title: {
                text: 'Porcentaje de total de compras por proveedor'
            },
            tooltip: {
                pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
            },
            accessibility: {
                point: {
                    valueSuffix: '%'
                }
            },
            plotOptions: {
                pie: {
                    allowPointSelect: true,
                    cursor: 'pointer',
                    dataLabels: {
                        enabled: true,
                        format: '<b>{point.name}</b>: {point.percentage:.1f} %'
                    },
                    showInLegend: true
                }
            },
            series: [{
                name: 'Proveedores',
                colorByPoint: true,
                data: chartData
            }]
        
});
});

});
</script>
{% endblock %}

{% block content %}
<div style="width: 100%; height: 100px; background-color: #051922; margin: 0 auto; padding: 0; "></div>

<div id="wrapper" >
		{% block sidebar %}
			{{sidebar("Dashboard")}}
		{% endblock %}
		
		
		
		<!-- Begin Page Content -->
		<div class="container-fluid">
			<br>
			<!-- Page Heading -->
			<div class="d-sm-flex align-items-center justify-content-between mb-4">
				<h1 class="h3 mb-0 text-gray-800">Dashboard</h1>
			</div>

			<!-- Content Row -->
			<div class="row">

				<!-- Ingresos -->
				<div class="col-xl-3 col-md-6 mb-4">
					<div class="card border-left-success shadow h-100 py-2">
						<div class="card-body">
							<div class="row no-gutters align-items-center">
								<div class="col mr-2">
									<div class="text-xs font-weight-bold text-success text-uppercase mb-1">
										Ingresos (Ãšltimo mes)</div>
									<div class="h5 mb-0 font-weight-bold text-gray-800">${{inmes.ingresosMes}}</div>
								</div>
								<div class="col-auto">
									<i class="fas fa-arrow-up fa-2x text-gray-300"></i>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Egresos -->
				<div class="col-xl-3 col-md-6 mb-4">
					<div class="card border-left-danger shadow h-100 py-2">
						<div class="card-body">
							<div class="row no-gutters align-items-center">
								<div class="col mr-2">
									<div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
										Egresos</div>
									<div class="h5 mb-0 font-weight-bold text-gray-800">${{ "%.2f" | format(outmes.egresosMes)  }}</div>
								</div>
								<div class="col-auto">
									<i class="fas fa-arrow-down fa-2x text-gray-300"></i>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Earnings Mensual -->
				<div class="col-xl-3 col-md-6 mb-4">
					<div class="card border-left-primary shadow h-100 py-2">
						<div class="card-body">
							<div class="row no-gutters align-items-center">
								<div class="col mr-2">
									<div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
										Ganancias (&Uacute;ltimo mes)</div>
									<div class="h5 mb-0 font-weight-bold text-gray-800">${{inmes.ingresosMes - outmes.egresosMes}}</div>
								</div>
								<div class="col-auto">
									<i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- Earnings Totales -->
				<div class="col-xl-3 col-md-6 mb-4">
					<div class="card border-left-primary shadow h-100 py-2">
						<div class="card-body">
							<div class="row no-gutters align-items-center">
								<div class="col mr-2">
									<div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
										Ganancias (Totales)
									</div>
									
									<div class="h5 mb-0 font-weight-bold text-gray-800"> ${{gTotales.total}} </div>
								</div>
								<div class="col-auto">
									<i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
								</div>
							</div>
						</div>
					</div>
				</div>

				

			
				<!-- Area Chart -->
				<div class="col-xl-6 col-lg-5">
					<div class="card shadow mb-4">
						<!-- Card Header - Dropdown -->
						<div
							class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
							<h6 class="m-0 font-weight-bold text-primary">Productos mas comprados</h6>
						</div>
						<!-- Card Body -->
						<div class="card-body">
							<div class="chart-area">
								<div id="histograma" style="width:100%; height:100%;"></div>
							</div>
						</div>
					</div>
				</div>

				<!-- Pie Chart -->
				<div class="col-xl-6 col-lg-7">
					<div class="card shadow mb-4">
						<!-- Card Header - Dropdown -->
						<div
							class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
							<h6 class="m-0 font-weight-bold text-primary">Porcentaje de total de compras por Proveedor</h6>
						
						</div>
						<!-- Card Body -->
						<div class="card-body" style="height:450px;">
							<div class="chart-pie pt-4 pb-2">
								<div id="piechart" style="width:100%;"></div>
							</div>
							
						</div>
					</div>
				</div>
			</div>
		</div>
		<!-- /.container-fluid -->
	</div>
</div>
<!-- End of Main Content -->
{% endblock %}